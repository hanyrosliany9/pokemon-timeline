FROM node:20-alpine

WORKDIR /app

# Copy entire monorepo structure
COPY package*.json ./
COPY . .

# Install dependencies (with workspaces)
RUN npm ci --workspaces --include-workspace-root

# Build shared package first
RUN npm run --workspace=shared build

# Expose Vite dev server port
EXPOSE 5173

# Start Vite dev server with hot reload
# --host 0.0.0.0 makes it accessible from outside the container
CMD ["npm", "run", "-w", "frontend", "dev", "--", "--host", "0.0.0.0"]
